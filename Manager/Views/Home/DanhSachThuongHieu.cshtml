@model List<Manager.Models.ThuongHieu>
@{
    ViewBag.Title = "Thương Hiệu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />


<div class="container py-4">
    <h3 class="fw-bold mb-3">Danh sách thương hiệu</h3>

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb bg-info bg-opacity-25 px-3 py-2 rounded">
            <li class="breadcrumb-item"><a href="#">Trang chủ</a></li>
            <li class="breadcrumb-item active" aria-current="page">Thương hiệu</li>
        </ol>
    </nav>

    <!-- Action Bar -->
    <div class="d-flex flex-wrap align-items-center mb-3 gap-2">
        <a href="#" class="btn btn-success"><i class="bi bi-plus-circle"></i> Tạo mới</a>
        <input type="text" class="form-control w-auto" placeholder="Tìm kiếm..." />
        <button class="btn btn-primary"><i class="bi bi-search"></i></button>
        <button class="btn btn-dark">Đặt lại</button>
        <button id="btnXoaNhieu" class="btn btn-danger d-none" onclick="xoaNhieu()">
            <i class="bi bi-trash3"></i> Xóa đã chọn
        </button>
    </div>

    <!-- Table -->
    <div class="table-responsive">
        <table class="table table-bordered align-middle text-center">
            <thead class="table-light">
                <tr>
                    <th style="width: 50px;">
                        <input type="checkbox" id="checkAll" />
                    </th>
                    <th>Mã TH</th>
                    <th>Tên thương hiệu</th>
                    <th>Mô tả</th>
                    <th>Logo</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <input type="checkbox" class="check-item" value="@item.MaThuongHieu" />
                        </td>
                        <td>@item.MaThuongHieu</td>
                        <td>@item.TenThuongHieu</td>
                        <td>@(item.MoTa ?? "Chưa có mô tả")</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.Logo))
                            {
                                <img src="/Content/img/thuonghieu/@item.Logo" alt="Logo" style="height: 40px;" />
                            }
                            else
                            {
                                <span>Không có logo</span>
                            }
                        </td>
                        <td>
                            @(item.TrangThai == true ? "Hiển thị" : "Ẩn")
                        </td>
                        <td>
                            <a href="#" class="btn btn-sm btn-warning btn-delete" data-id="@item.MaThuongHieu" data-name="@item.TenThuongHieu" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                                <i class="bi bi-trash3"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Modal Xác nhận xóa -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Xác nhận xóa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Xóa</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal thông báo không thể xóa -->
    <div class="modal fade" id="cannotDeleteModal" tabindex="-1" aria-labelledby="cannotDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title" id="cannotDeleteModalLabel">Không thể xóa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">
                    Thương hiệu này đang được sử dụng trong bảng Hàng Hóa. Vui lòng xóa sản phẩm trước.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Xóa thành công -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="successModalLabel">Thành công</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">
                    Đã xóa thương hiệu thành công!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    $(document).ready(function () {
        $('.btn-warning').click(function () {
            var maTH = $(this).closest('tr').find('.check-item').val();

            if (!maTH) return;

            $('#deleteMessage').text("Bạn có chắc chắn muốn xóa thương hiệu này?");
            $('#confirmDeleteModal').modal('show');

            $('#confirmDelete').off('click').on('click', function () {
                $.ajax({
                    url: '@Url.Action("XoaMotThuongHieu", "Home")',
                    type: 'POST',
                    data: { id: maTH },
                    success: function (response) {
                        $('#confirmDeleteModal').modal('hide');
                        if (response.success) {
                            $('#successModal').modal('show');
                            setTimeout(function () {
                                location.reload();
                            }, 1500);
                        }
                        else {
                            if (response.reason === "coSanPham") {
                                $('#cannotDeleteModal').modal('show');
                            } else {
                                alert(response.message || "Xóa thất bại");
                            }
                        }
                    },
                    error: function () {
                        alert("Lỗi khi gọi server.");
                    }
                });
            });
        });
    });
    </script>



</div>


